<!DOCTYPE html>
<html>
<head>
    <title>QR Code Scanner</title>
    <script src="https://unpkg.com/@zxing/library@0.18.6/umd/index.min.js"></script>
    <style>
        #scanner-container {
            width: 100%;
            height: 400px;
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <h1>QR Code Scanner 5</h1>
    <button id="start-scan-btn">Start Scan</button>
    <video id="scanner-container"></video>
    <div id="result"></div>

    <script>
        const codeReader = new ZXing.BrowserQRCodeReader();

        function startScan() {
            const videoElement = document.getElementById('scanner-container');

            codeReader.decodeFromInputVideoDevice(undefined, videoElement)
                .then(result => {
                    document.getElementById('result').innerText = 'Scanned QR Code: ' + result.text;
                    sendQRCodeToSalesforce(result.text);
                })
                .catch(err => console.error(err));
        }

        function sendQRCodeToSalesforce(code) {
            var xhr = new XMLHttpRequest();
            var url = 'https://java-ability-263-dev-ed.scratch.my.salesforce.com/services/apexrest/qrscan';
            xhr.open('POST', url, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('Authorization', 'Bearer 00D8B000001CHS4!AQUAQBy64r_orLHAbyj6d8QAekFAms2X_JeyxMLR.19qQo4l4m6mqLwYrNjGJd8SyEbfOconbtsNNI9eOd3G5tmOegWh.St8'); 
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log('QR Code sent to Salesforce successfully.');
                }
            };
            var data = JSON.stringify({ "qrCode": code });
            xhr.send(data);
        }

        document.getElementById('start-scan-btn').addEventListener('click', startScan);
    </script>
</body>
</html>
